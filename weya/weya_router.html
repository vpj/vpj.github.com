<!DOCTYPE html>

<html>
<head>
  <title>Weya.Router.litcoffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="example.html">
                example.litcoffee
              </a>
            
              
              <a class="source" href="weya.html">
                weya.litcoffee
              </a>
            
              
              <a class="source" href="weya_base.html">
                weya_base.litcoffee
              </a>
            
              
              <a class="source" href="weya_router.html">
                weya_router.litcoffee
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="weya-router-litcoffee">Weya.Router.litcoffee</h1>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-property">@Weya</span> = {} <span class="hljs-keyword">unless</span> <span class="hljs-property">@Weya</span>?
Weya = <span class="hljs-property">@Weya</span>

<span class="hljs-keyword">if</span> <span class="hljs-built_in">exports</span>?
 Weya = <span class="hljs-built_in">require</span> <span class="hljs-string">'./weya'</span>
 Weya.Base = <span class="hljs-built_in">require</span> <span class="hljs-string">'./weya_base'</span>

<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> Weya.Base?
 <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error <span class="hljs-string">'Weya.Base not found'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2 id="weya-router">Weya.Router</h2>
<p>Routing with hash tags or pushState</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Router</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Weya</span>.<span class="hljs-title">Base</span></span>
 <span class="hljs-attribute">optionalParam</span>: <span class="hljs-regexp">/\((.*?)\)/g</span>
 <span class="hljs-attribute">namedParam</span>: <span class="hljs-regexp">/(\(\?)?:\w+/g</span>
 <span class="hljs-attribute">splatParam</span>: <span class="hljs-regexp">/\*\w+/g</span>
 <span class="hljs-attribute">escapeRegExp</span>: <span class="hljs-regexp">/[\-{}\[\]+?.,\\\^$|#\s]/g</span>

 <span class="hljs-property">@initialize</span><span class="hljs-function"> -&gt;</span>
  <span class="hljs-property">@_bindRoutes</span>()
  <span class="hljs-property">@_event</span> = <span class="hljs-literal">null</span>
  <span class="hljs-property">@_history</span> = []

 <span class="hljs-attribute">_routes</span>: {}</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h4 id="register-router">Register router</h4>
<p><code>&#39;analyse/:analysis&#39;: &#39;onAnalyse&#39;</code>
<code>dashboard&#39;: [&#39;auth&#39;, &#39;dashboard&#39;]</code>
This will match urls of the form <code>analyse/\*</code> and call method @onAnalyse with the parameter.
Second route will first call @auth and and call @dashboard only if it returns true
The most specific route should be at bottom
Routers can added or overridden in subclasses</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-property">@routes</span>: <span class="hljs-function"><span class="hljs-params">(routes)</span> -&gt;</span>
  @::_routes = _.clone @::_routes
  <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">of</span> routes
   @::_routes[k] = v</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h4 id="starts-routing">Starts routing</h4>
<p>Option silent will not trigger an event for the current url</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-attribute">start</span>: <span class="hljs-function"><span class="hljs-params">(options)</span> -&gt;</span>
  Weya.history.start options
  fragment = Weya.history.getFragment()

  <span class="hljs-keyword">if</span> options?.silent <span class="hljs-keyword">is</span> <span class="hljs-literal">on</span>
   <span class="hljs-property">@_history</span>.push <span class="hljs-attribute">fragment</span>: fragment, <span class="hljs-attribute">title</span>: <span class="hljs-built_in">document</span>.title</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h4 id="goes-to-previous-page-if-exists">Goes to previous page if exists</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-attribute">back</span>:<span class="hljs-function"> -&gt;</span>
  <span class="hljs-keyword">if</span> <span class="hljs-property">@_history</span>.length &gt; <span class="hljs-number">1</span>
   Weya.history.back()</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h4 id="whether-it-is-possible-to-go-to-previous-page">Whether it is possible to go to previous page</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-attribute">canBack</span>:<span class="hljs-function"> -&gt;</span>
  <span class="hljs-keyword">if</span> <span class="hljs-property">@_history</span>.length &gt; <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> Weya.history.canBack()
   <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
  <span class="hljs-keyword">else</span>
   <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h4 id="registers-a-route">Registers a route</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-attribute">route</span>: <span class="hljs-function"><span class="hljs-params">(route, name)</span> -&gt;</span>
  (route = <span class="hljs-property">@_routeToRegExp</span> route) <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> _.isRegExp route</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Registers the route with Weya.history</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Weya.history.route route, <span class="hljs-function"><span class="hljs-params">(fragment, event)</span> =&gt;</span>
   args = <span class="hljs-property">@_extractParameters</span> route, fragment
   <span class="hljs-property">@_event</span> = event</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Handle state</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>   <span class="hljs-keyword">if</span> <span class="hljs-property">@_event</span>?.type <span class="hljs-keyword">is</span> <span class="hljs-string">"popstate"</span>
    <span class="hljs-property">@_history</span>.pop()
    <span class="hljs-keyword">if</span> <span class="hljs-property">@_history</span>.length <span class="hljs-keyword">is</span> <span class="hljs-number">0</span>
     <span class="hljs-property">@_history</span>.push <span class="hljs-attribute">fragment</span>: fragment, <span class="hljs-attribute">title</span>: <span class="hljs-built_in">document</span>.title, <span class="hljs-attribute">state</span>: <span class="hljs-property">@getState</span>()
   <span class="hljs-keyword">else</span>
    <span class="hljs-property">@_history</span>.push <span class="hljs-attribute">fragment</span>: fragment, <span class="hljs-attribute">title</span>: <span class="hljs-built_in">document</span>.title, <span class="hljs-attribute">state</span>: <span class="hljs-property">@getState</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Calls callbacks in order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>   callbacks = name
   callbacks = [callbacks] <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> Array.isArray callbacks

   <span class="hljs-keyword">for</span> callback <span class="hljs-keyword">in</span> callbacks
    callback = @[callback]
    <span class="hljs-keyword">break</span> <span class="hljs-keyword">unless</span> callback.apply <span class="hljs-keyword">this</span>, args</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h4 id="gets-the-current-html5-history-state">Gets the current HTML5 History state</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-attribute">getState</span>:<span class="hljs-function"> -&gt;</span>
  <span class="hljs-keyword">if</span> <span class="hljs-property">@_event</span>?.originalEvent?.state?
   <span class="hljs-keyword">return</span> <span class="hljs-property">@_event</span>.originalEvent.state
  <span class="hljs-keyword">else</span>
   <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <h4 id="navigate-to-a-new-url-while-setting-html5-history-state">Navigate to a new URL, while setting HTML5 History state</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-attribute">navigate</span>: <span class="hljs-function"><span class="hljs-params">(fragment, options)</span> -&gt;</span>
  options = {} <span class="hljs-keyword">unless</span> options
  <span class="hljs-keyword">if</span> options.replace
   <span class="hljs-property">@_history</span>.pop()
  <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> options.trigger
   <span class="hljs-property">@_history</span>.push <span class="hljs-attribute">fragment</span>: fragment, <span class="hljs-attribute">title</span>: options.title, <span class="hljs-attribute">state</span>: options.state

  Weya.history.navigate fragment, options</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Bind routes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-attribute">_bindRoutes</span>:<span class="hljs-function"> -&gt;</span>
  <span class="hljs-keyword">for</span> route, name <span class="hljs-keyword">of</span> <span class="hljs-property">@_routes</span>
   <span class="hljs-property">@route</span> route, name</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Convert a route string into a regular expression, suitable for matching</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-attribute">_routeToRegExp</span>: <span class="hljs-function"><span class="hljs-params">(route)</span> -&gt;</span>
  route = route.replace <span class="hljs-property">@escapeRegExp</span>, <span class="hljs-string">'\\$&amp;'</span>
               .replace <span class="hljs-property">@noptionalParam</span>, <span class="hljs-string">'(?:$1)?'</span>
               .replace <span class="hljs-property">@namedParam</span>, <span class="hljs-function"><span class="hljs-params">(match, optional)</span> -&gt;</span>
                 <span class="hljs-keyword">if</span> optional <span class="hljs-keyword">then</span> match <span class="hljs-keyword">else</span> <span class="hljs-string">'([^\/]+)'</span>
               .replace <span class="hljs-property">@splatParam</span>, <span class="hljs-string">'(.*?)'</span>

   <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RegExp <span class="hljs-string">"^<span class="hljs-subst">#{route}</span>$"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Extract parameters from a route regex and URL</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-attribute">_extractParameters</span>: <span class="hljs-function"><span class="hljs-params">(route, fragment)</span> -&gt;</span>
  params = route.exec(fragment).slice(<span class="hljs-number">1</span>)
  <span class="hljs-keyword">return</span> _.map params, <span class="hljs-function"><span class="hljs-params">(param)</span> -&gt;</span>
   <span class="hljs-keyword">if</span> param <span class="hljs-keyword">then</span> decodeURIComponent(param) <span class="hljs-keyword">else</span> <span class="hljs-literal">null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <h2 id="history-class">History class</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">History</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Weya</span>.<span class="hljs-title">Base</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Strip leading hash/slash and trailing space</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-attribute">routeStripper</span>: <span class="hljs-regexp">/^[#\/]|\s+$/g</span></pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Strip leading and trailing slashes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-attribute">rootStripper</span>: <span class="hljs-regexp">/^\/+|\/+$/g</span></pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Remove trailing slash</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-attribute">trailingSlash</span>: <span class="hljs-regexp">/\/</span>$/</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Strip urls of hash and query</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-attribute">pathStripper</span>: <span class="hljs-regexp">/[?#].*$/</span>

 <span class="hljs-property">@initialize</span><span class="hljs-function"> -&gt;</span>
  <span class="hljs-property">@handlers</span> = []
  _.bindAll <span class="hljs-keyword">this</span>, <span class="hljs-string">'checkUrl'</span>
  <span class="hljs-property">@history</span> = <span class="hljs-built_in">window</span>.history
  <span class="hljs-property">@location</span> = <span class="hljs-built_in">window</span>.location
  <span class="hljs-property">@stateList</span> = []</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Hash check interval</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-attribute">interval</span>: <span class="hljs-number">50</span></pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Get hash value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-attribute">getHash</span>:<span class="hljs-function"> -&gt;</span>
  match = <span class="hljs-property">@location</span>.href.match <span class="hljs-regexp">/#(.*)$/</span>
  <span class="hljs-keyword">return</span> (<span class="hljs-keyword">if</span> match? <span class="hljs-keyword">then</span> match[<span class="hljs-number">1</span>] <span class="hljs-keyword">else</span> <span class="hljs-string">''</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Get emulated state</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-attribute">getEmulateState</span>:<span class="hljs-function"> -&gt;</span>
  <span class="hljs-keyword">if</span> <span class="hljs-property">@stateList</span>.length &gt; <span class="hljs-number">0</span>
   <span class="hljs-keyword">return</span> <span class="hljs-property">@stateList</span>[<span class="hljs-property">@stateList</span>.length - <span class="hljs-number">1</span>]
  <span class="hljs-keyword">else</span>
   <span class="hljs-keyword">return</span> {<span class="hljs-attribute">fragment</span>: <span class="hljs-string">""</span>}

 <span class="hljs-attribute">popEmulateState</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-property">@stateList</span>.pop()

 <span class="hljs-attribute">pushEmulateState</span>: <span class="hljs-function"><span class="hljs-params">(state, title, fragment)</span> -&gt;</span>
  <span class="hljs-property">@stateList</span>.push
   <span class="hljs-attribute">state</span>: state
   <span class="hljs-attribute">title</span>: title
   <span class="hljs-attribute">fragment</span>: fragment</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Get the URL fragment</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-attribute">getFragment</span>: <span class="hljs-function"><span class="hljs-params">(fragment, forcePushState)</span> -&gt;</span>
  <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> fragment?
   <span class="hljs-keyword">if</span> <span class="hljs-property">@_emulateState</span>
    fragment = <span class="hljs-property">@getEmulateState</span>().fragment
   <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-property">@_hasPushState</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> <span class="hljs-property">@_wantsHashChange</span> <span class="hljs-keyword">or</span> forcePushState
    fragment = <span class="hljs-property">@location</span>.pathname
    root = <span class="hljs-property">@root</span>.replace <span class="hljs-property">@trailingSlash</span>, <span class="hljs-string">''</span>
    <span class="hljs-keyword">if</span> (fragment.indexOf root) <span class="hljs-keyword">is</span> <span class="hljs-number">0</span>
     fragment = fragment.slice root.length
   <span class="hljs-keyword">else</span>
    fragment = <span class="hljs-property">@getHash</span>()

  <span class="hljs-keyword">return</span> fragment.replace <span class="hljs-property">@routeStripper</span>, <span class="hljs-string">''</span></pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <h4 id="goto-the-previous-page">Goto the previous page</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-attribute">back</span>:<span class="hljs-function"> -&gt;</span>
  <span class="hljs-keyword">if</span> <span class="hljs-property">@_emulateState</span> <span class="hljs-keyword">is</span> <span class="hljs-literal">on</span>
   <span class="hljs-property">@popEmulateState</span>()
   <span class="hljs-property">@loadUrl</span> <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>
  <span class="hljs-keyword">else</span>
   <span class="hljs-property">@history</span>?.back?()</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <h4 id="can-back-">Can back?</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-attribute">canBack</span>:<span class="hljs-function"> -&gt;</span>
  <span class="hljs-keyword">if</span> <span class="hljs-property">@_emulateState</span> <span class="hljs-keyword">is</span> <span class="hljs-literal">on</span>
   <span class="hljs-keyword">return</span> <span class="hljs-property">@stateList</span>.length &gt; <span class="hljs-number">1</span>
  <span class="hljs-keyword">else</span>
   <span class="hljs-keyword">return</span> <span class="hljs-property">@history</span>?.back?</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <h4 id="start-listening-to-events">Start listening to events</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-attribute">start</span>: <span class="hljs-function"><span class="hljs-params">(options)</span> -&gt;</span>
  History.started = <span class="hljs-literal">true</span>

  <span class="hljs-property">@options</span> = _.extend {<span class="hljs-attribute">root</span>: <span class="hljs-string">'/'</span>}, <span class="hljs-property">@options</span>, options
  <span class="hljs-property">@root</span> = <span class="hljs-property">@options</span>.root
  <span class="hljs-property">@_emulateState</span> = <span class="hljs-property">@options</span>.emulateState <span class="hljs-keyword">is</span> <span class="hljs-literal">on</span>
  <span class="hljs-property">@_wantsHashChange</span> = <span class="hljs-property">@_emulateState</span> <span class="hljs-keyword">is</span> <span class="hljs-literal">off</span> <span class="hljs-keyword">and</span> <span class="hljs-property">@options</span>.hashChange <span class="hljs-keyword">isnt</span> <span class="hljs-literal">off</span>
  <span class="hljs-property">@_wantsPushState</span> = <span class="hljs-property">@_emulateState</span> <span class="hljs-keyword">is</span> <span class="hljs-literal">off</span> <span class="hljs-keyword">and</span> <span class="hljs-property">@options</span>.pushState <span class="hljs-keyword">is</span> <span class="hljs-literal">on</span>
  <span class="hljs-property">@_hasPushState</span> = <span class="hljs-property">@_wantsPushState</span> <span class="hljs-keyword">is</span> <span class="hljs-literal">on</span> <span class="hljs-keyword">and</span> <span class="hljs-property">@history</span>?.pushState?
  <span class="hljs-keyword">if</span> <span class="hljs-property">@_emulateState</span> <span class="hljs-keyword">and</span> <span class="hljs-property">@options</span>.start?
   <span class="hljs-property">@pushEmulateState</span> <span class="hljs-property">@options</span>.start.state, <span class="hljs-property">@options</span>.start.title, <span class="hljs-property">@options</span>.start.fragment

  <span class="hljs-property">@fragment</span> = <span class="hljs-property">@getFragment</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Normalize root to always include a leading and trailing slash.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-property">@root</span> = <span class="hljs-string">"/<span class="hljs-subst">#{<span class="hljs-property">@root</span>}</span>/"</span>.replace <span class="hljs-property">@rootStripper</span>, <span class="hljs-string">'/'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Depending on whether we&#39;re using pushState or hashes, and whether
&#39;onhashchange&#39; is supported, determine how we check the URL state.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> <span class="hljs-property">@_hasPushState</span>
   $(<span class="hljs-built_in">window</span>).<span class="hljs-literal">on</span> <span class="hljs-string">'popstate'</span>, <span class="hljs-property">@checkUrl</span>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-property">@_wantsHashChange</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">window</span>.onhashchange?
   @(<span class="hljs-built_in">window</span>).<span class="hljs-literal">on</span> <span class="hljs-string">'hashchange'</span>, <span class="hljs-property">@checkUrl</span>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-property">@_wantsHashChange</span>
   <span class="hljs-property">@_checkUrlInterval</span> = setInterval <span class="hljs-property">@checkUrl</span>, <span class="hljs-property">@interval</span>

  <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-property">@options</span>.silent
   <span class="hljs-property">@loadUrl</span> <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <h4 id="add-a-listener-to-a-router">Add a listener to a router</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-attribute">route</span>: <span class="hljs-function"><span class="hljs-params">(route, callback)</span> -&gt;</span>
  <span class="hljs-property">@handlers</span>.unshift <span class="hljs-attribute">route</span>: route, <span class="hljs-attribute">callback</span>: callback</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Check current url for changes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-attribute">checkUrl</span>: <span class="hljs-function"><span class="hljs-params">(e)</span> -&gt;</span>
  fragment = <span class="hljs-property">@getFragment</span>()
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> fragment <span class="hljs-keyword">is</span> <span class="hljs-property">@fragment</span>
  <span class="hljs-property">@loadUrl</span> fragment, e</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Call callbacks of matching route</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-attribute">loadUrl</span>: <span class="hljs-function"><span class="hljs-params">(fragment, e)</span> -&gt;</span>
  fragment = <span class="hljs-property">@fragment</span> = <span class="hljs-property">@getFragment</span> fragment
  <span class="hljs-keyword">return</span> _.any <span class="hljs-keyword">this</span>.handlers, <span class="hljs-function"><span class="hljs-params">(handler)</span> -&gt;</span>
   <span class="hljs-keyword">if</span> handler.route.test fragment
    handler.callback fragment, e
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
   <span class="hljs-keyword">else</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <h4 id="navigate-to-a-url">Navigate to a URL</h4>
<p>Triggers a route is option trigger is on
Replaces the url is option replace is on
Sets state and title</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-attribute">navigate</span>: <span class="hljs-function"><span class="hljs-params">(fragment, options)</span> -&gt;</span>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> History.started

  fragment = <span class="hljs-property">@getFragment</span>(fragment <span class="hljs-keyword">or</span> <span class="hljs-string">''</span>)
  url = <span class="hljs-property">@root</span> + fragment</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Strip the fragment of the query and hash for matching.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  fragment = fragment.replace <span class="hljs-property">@pathStripper</span>, <span class="hljs-string">''</span>

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> <span class="hljs-property">@fragment</span> <span class="hljs-keyword">is</span> fragment
  <span class="hljs-property">@fragment</span> = fragment</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Don&#39;t include a trailing slash on the root.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> fragment <span class="hljs-keyword">is</span> <span class="hljs-string">''</span> <span class="hljs-keyword">and</span> url <span class="hljs-keyword">isnt</span> <span class="hljs-string">'/'</span>
   url = url.slice <span class="hljs-number">0</span>, -<span class="hljs-number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>If pushState is available, we use it to set the fragment as a real URL.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> <span class="hljs-property">@_emulateState</span>
   <span class="hljs-keyword">if</span> options.replace <span class="hljs-keyword">is</span> <span class="hljs-literal">on</span>
    <span class="hljs-property">@popEmulateState</span>()
   state = {}
   state = options.state <span class="hljs-keyword">if</span> options.state?
   title = <span class="hljs-string">''</span>
   title = options.title <span class="hljs-keyword">if</span> options.title?
   <span class="hljs-property">@pushEmulateState</span> state, title, fragment
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-property">@_hasPushState</span>
   method = <span class="hljs-keyword">if</span> options.replace <span class="hljs-keyword">then</span> <span class="hljs-string">'replaceState'</span> <span class="hljs-keyword">else</span> <span class="hljs-string">'pushState'</span>
   state = {}
   state = options.state <span class="hljs-keyword">if</span> options.state?
   title = <span class="hljs-string">''</span>
   title = options.title <span class="hljs-keyword">if</span> options.title?
   <span class="hljs-property">@history</span>[method] state, title, url</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>If hash changes haven&#39;t been explicitly disabled, update the hash
fragment to store history.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-property">@_wantsHashChange</span>
   <span class="hljs-property">@_updateHash</span> <span class="hljs-property">@location</span>, fragment, options.replace</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>If you&#39;ve told us that you explicitly don&#39;t want fallback hashchange-
based history, then <code>navigate</code> becomes a page refresh.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">else</span>
   <span class="hljs-keyword">return</span> <span class="hljs-property">@location</span>.assign url
  <span class="hljs-keyword">if</span> options.trigger
   <span class="hljs-keyword">return</span> <span class="hljs-property">@loadUrl</span> fragment, <span class="hljs-literal">null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Update the hash</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-attribute">_updateHash</span>: <span class="hljs-function"><span class="hljs-params">(location, fragment, replace)</span> -&gt;</span>
  <span class="hljs-keyword">if</span> replace
   href = location.href.replace <span class="hljs-regexp">/(javascript:|#).*$/</span>, <span class="hljs-string">''</span>
   location.replace <span class="hljs-string">"<span class="hljs-subst">#{href}</span>#<span class="hljs-subst">#{fragment}</span>"</span>
  <span class="hljs-keyword">else</span>
   location.hash = <span class="hljs-string">"#<span class="hljs-subst">#{fragment}</span>"</span>

Weya.Router = Router
Weya.history = <span class="hljs-keyword">new</span> History

<span class="hljs-keyword">if</span> <span class="hljs-built_in">module</span>?
 <span class="hljs-built_in">module</span>.<span class="hljs-built_in">exports</span> = Weya.Router</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
