<!DOCTYPE html><html>
 <head>
  <meta charset="utf-8">
  </meta>
  <title>
   Coffeescript helpers for d3.js
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </meta>
  <meta name="apple-mobile-web-app-capable" content="yes">
  </meta>
  <link href="http://fonts.googleapis.com/css?family=Raleway:400,100,200,300,500,600,700,800,900" rel="stylesheet" type="text/css">
  </link>
  <link href="lib/skeleton/css/skeleton.css" rel="stylesheet">
  </link>
  <link href="lib/highlightjs/styles/default.css" rel="stylesheet">
  </link>
  <link href="css/style.css" rel="stylesheet">
  </link>
  <link href="blog.css" rel="stylesheet">
  </link>
  <script>
   (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-44255805-1', 'auto');
ga('send', 'pageview');
  </script>
 </head>
 <body>
  <div class="container wallapatta-container ">
   <div class="header ">
    <h1>
     <a href="index.html">
      VARUNA JAYASIRI
     </a>
    </h1>
    <a class="button " href="https://www.twitter.com/vpj">
     @vpj
    </a>
   </div>
   <div class="wallapatta ">
    <h1 class="title ">
     Coffeescript helpers for d3.js
    </h1>
    <h3 class="date ">
     December 28, 2013
    </h3>
    <div style="margin-bottom:30px;">
     <a class="twitter-share-button " href="https://twitter.com/share" data-via="vpj" data-size="large">
      Tweet
     </a>
     <script>
      !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');
     </script>
    </div>
    <div class="row ">
     <div class="wallapatta-main nine columns ">
      <div id="wallapatta_0" class="article"><div id="wallapatta_1" class="section"><div class="content"><p id="wallapatta_2" class="paragraph"><a id="wallapatta_20" class="link" href="https://github.com/vpj/FP">fp.js</a><span id="wallapatta_21" class="text"> is a tiny library to help keep </span><a id="wallapatta_22" class="link" href="http://d3js.org/">d3.js</a><span id="wallapatta_23" class="text"> dom manipulation code clean.</span></p></div></div><div id="wallapatta_8" class="section"><div class="content"><p id="wallapatta_9" class="paragraph"><span id="wallapatta_31" class="text">I write a lot of d3.js code and most dom manipulation code got complicated and hard to maintain. With fp.js attributes, styles and events can be set easily. But the most important fact is that FP.js lets you maintain indentation in coffescript code that matches the dom structure.</span></p></div></div><pre id="wallapatta_10" class="codeBlock"><code class="coffeescript">numbers = [<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">23</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">25</span>, <span class="hljs-number">11</span>, <span class="hljs-number">19</span>, <span class="hljs-number">20</span>]
chartHeight = <span class="hljs-number">300</span>

chart = d3.select(<span class="hljs-string">"body"</span>)
 .append(<span class="hljs-string">"svg"</span>)
 .attr(<span class="hljs-string">"width"</span>, <span class="hljs-string">"100%"</span>)
 .attr(<span class="hljs-string">"height"</span>, <span class="hljs-string">"100%"</span>)

bars = chart.selectAll(<span class="hljs-string">"g.bar"</span>).data(numbers).enter()
 .append(<span class="hljs-string">"g"</span>)
 .attr(<span class="hljs-string">"class"</span>, <span class="hljs-string">"bar"</span>)

bars.append(<span class="hljs-string">"rect"</span>)
 .attr(<span class="hljs-string">"y"</span>, <span class="hljs-function"><span class="hljs-params">(d)</span> -&gt;</span> chartHeight - d * <span class="hljs-number">10</span>)
 .attr(<span class="hljs-string">"x"</span>, <span class="hljs-function"><span class="hljs-params">(d, i)</span> -&gt;</span> i * <span class="hljs-number">20</span>)
 .attr(<span class="hljs-string">"width"</span>, <span class="hljs-number">20</span>)
 .attr(<span class="hljs-string">"height"</span>, <span class="hljs-function"><span class="hljs-params">(d)</span> -&gt;</span> d * <span class="hljs-number">10</span>)

bars.append(<span class="hljs-string">"line"</span>)
 .attr(<span class="hljs-string">"class"</span>, <span class="hljs-string">"budget"</span>)
 .attr(<span class="hljs-string">"y1"</span>, <span class="hljs-function"><span class="hljs-params">(d)</span> -&gt;</span> chartHeight - d * <span class="hljs-number">9</span>)
 .attr(<span class="hljs-string">"y2"</span>, <span class="hljs-function"><span class="hljs-params">(d)</span> -&gt;</span> chartHeight - d * <span class="hljs-number">9</span>)
 .attr(<span class="hljs-string">"x1"</span>, <span class="hljs-function"><span class="hljs-params">(d, i)</span> -&gt;</span> i * <span class="hljs-number">20</span>)
 .attr(<span class="hljs-string">"x2"</span>, <span class="hljs-function"><span class="hljs-params">(d, i)</span> -&gt;</span> i * <span class="hljs-number">20</span> + <span class="hljs-number">20</span>)
 .attr(<span class="hljs-string">"stroke"</span>, <span class="hljs-function"><span class="hljs-params">(d)</span> -&gt;</span> <span class="hljs-keyword">if</span> d &lt; <span class="hljs-number">20</span> <span class="hljs-keyword">then</span> <span class="hljs-string">"white"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"#aaa"</span>)</code></pre><div id="wallapatta_11" class="section"><div class="content"><p id="wallapatta_12" class="paragraph"><span id="wallapatta_32" class="text">Above is plain code to draw a simple bar chart with d3.js, and below is the code with FP.js.</span></p></div></div><pre id="wallapatta_13" class="codeBlock"><code class="coffeescript">numbers = [<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">23</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">25</span>, <span class="hljs-number">11</span>, <span class="hljs-number">19</span>, <span class="hljs-number">20</span>]
chartHeight = <span class="hljs-number">300</span>

FP d3, <span class="hljs-string">'select'</span>, <span class="hljs-string">'body'</span>, <span class="hljs-function">-&gt;</span>
 FP @, <span class="hljs-string">'svg'</span>, <span class="hljs-attribute">width</span>: <span class="hljs-string">"100%"</span>, <span class="hljs-attribute">height</span>: <span class="hljs-string">"100%"</span>, <span class="hljs-function">-&gt;</span>
   FP @, <span class="hljs-string">'selectAll'</span>, <span class="hljs-string">'g.bar'</span>, <span class="hljs-function">-&gt;</span>
    FP @, <span class="hljs-string">'data'</span>, numbers, <span class="hljs-function">-&gt;</span>
     FP @, <span class="hljs-string">'enter'</span>, <span class="hljs-function">-&gt;</span>
      FP @, <span class="hljs-string">'g.bar'</span>, <span class="hljs-function">-&gt;</span>
       FP @, <span class="hljs-string">'rect'</span>,
        <span class="hljs-attribute">y</span>: <span class="hljs-function">(<span class="hljs-params">(d)</span> -&gt;</span> chartHeight - d * <span class="hljs-number">10</span>)
        <span class="hljs-attribute">x</span>: <span class="hljs-function">(<span class="hljs-params">(d, i)</span> -&gt;</span> i * <span class="hljs-number">20</span>)
        <span class="hljs-attribute">width</span>: <span class="hljs-number">20</span>, <span class="hljs-attribute">height</span>: <span class="hljs-function">(<span class="hljs-params">(d)</span> -&gt;</span> d * <span class="hljs-number">10</span>)
       FP @, <span class="hljs-string">'line.budget'</span>,
        <span class="hljs-attribute">y1</span>: <span class="hljs-function">(<span class="hljs-params">(d)</span> -&gt;</span> chartHeight - d * <span class="hljs-number">9</span>)
        <span class="hljs-attribute">y2</span>: <span class="hljs-function">(<span class="hljs-params">(d)</span> -&gt;</span> chartHeight - d * <span class="hljs-number">9</span>)
        <span class="hljs-attribute">x1</span>: <span class="hljs-function">(<span class="hljs-params">(d, i)</span> -&gt;</span> i * <span class="hljs-number">20</span>)
        <span class="hljs-attribute">x2</span>: <span class="hljs-function">(<span class="hljs-params">(d, i)</span> -&gt;</span> i * <span class="hljs-number">20</span> + <span class="hljs-number">20</span>)
        <span class="hljs-attribute">stroke</span>: <span class="hljs-function">(<span class="hljs-params">(d)</span> -&gt;</span> <span class="hljs-keyword">if</span> d &lt; <span class="hljs-number">20</span> <span class="hljs-keyword">then</span> <span class="hljs-string">"white"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"#aaa"</span>)</code></pre><div id="wallapatta_14" class="section"><div class="content"><p id="wallapatta_15" class="paragraph"><span id="wallapatta_33" class="text">I am planning to remove the clutter of </span><code id="wallapatta_34" class="code"><span id="wallapatta_35" class="text">FP @</span></code><span id="wallapatta_36" class="text">, so that it'll look like the following; but for that I will have to either use `with` keyword or create functions for </span><code id="wallapatta_37" class="code"><span id="wallapatta_38" class="text">select</span></code><span id="wallapatta_39" class="text">, </span><code id="wallapatta_40" class="code"><span id="wallapatta_41" class="text">rect</span></code><span id="wallapatta_42" class="text">, </span><code id="wallapatta_43" class="code"><span id="wallapatta_44" class="text">line</span></code><span id="wallapatta_45" class="text">, etc, in a local context similar to </span><a id="wallapatta_46" class="link" href="https://github.com/mauricemach/coffeekup/blob/master/src/coffeekup.coffee">coffeekup</a><span id="wallapatta_47" class="text">.</span></p></div></div><pre id="wallapatta_16" class="codeBlock"><code class="coffeescript">FP d3, <span class="hljs-function">-&gt;</span>
 select <span class="hljs-string">'body'</span>, <span class="hljs-function">-&gt;</span>
  svg <span class="hljs-attribute">width</span>: <span class="hljs-string">"100%"</span>, <span class="hljs-attribute">height</span>: <span class="hljs-string">"100%"</span>, <span class="hljs-function">-&gt;</span>
    selectAll <span class="hljs-string">'g.bar'</span>, <span class="hljs-function">-&gt;</span>
     data numbers, <span class="hljs-function">-&gt;</span>
      enter -&gt;
       g <span class="hljs-string">'.bar'</span>, <span class="hljs-function">-&gt;</span>
        rect
         <span class="hljs-attribute">y</span>: <span class="hljs-function">(<span class="hljs-params">(d)</span> -&gt;</span> chartHeight - d * <span class="hljs-number">10</span>)
         <span class="hljs-attribute">x</span>: <span class="hljs-function">(<span class="hljs-params">(d, i)</span> -&gt;</span> i * <span class="hljs-number">20</span>)
         <span class="hljs-attribute">width</span>: <span class="hljs-number">20</span>, <span class="hljs-attribute">height</span>: <span class="hljs-function">(<span class="hljs-params">(d)</span> -&gt;</span> d * <span class="hljs-number">10</span>)
        line <span class="hljs-string">'.budget'</span>,
         <span class="hljs-attribute">y1</span>: <span class="hljs-function">(<span class="hljs-params">(d)</span> -&gt;</span> chartHeight - d * <span class="hljs-number">9</span>)
         <span class="hljs-attribute">y2</span>: <span class="hljs-function">(<span class="hljs-params">(d)</span> -&gt;</span> chartHeight - d * <span class="hljs-number">9</span>)
         <span class="hljs-attribute">x1</span>: <span class="hljs-function">(<span class="hljs-params">(d, i)</span> -&gt;</span> i * <span class="hljs-number">20</span>)
         <span class="hljs-attribute">x2</span>: <span class="hljs-function">(<span class="hljs-params">(d, i)</span> -&gt;</span> i * <span class="hljs-number">20</span> + <span class="hljs-number">20</span>)
         <span class="hljs-attribute">stroke</span>: <span class="hljs-function">(<span class="hljs-params">(d)</span> -&gt;</span> <span class="hljs-keyword">if</span> d &lt; <span class="hljs-number">20</span> <span class="hljs-keyword">then</span> <span class="hljs-string">"white"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"#aaa"</span>)</code></pre><div id="wallapatta_17" class="section"><div class="content"><p id="wallapatta_18" class="paragraph"><span id="wallapatta_48" class="text">Another option is to use </span><code id="wallapatta_49" class="code"><span id="wallapatta_50" class="text">@</span></code><span id="wallapatta_51" class="text">, which cleaner and not that messy, but code readers might get confused whether </span><code id="wallapatta_52" class="code"><span id="wallapatta_53" class="text">@</span></code><span id="wallapatta_54" class="text"> is referring to the object you are making the call from. Also, using a one letter name such as </span><strong id="wallapatta_55" class="bold"><span id="wallapatta_56" class="text">$</span></strong><span id="wallapatta_57" class="text"> or </span><code id="wallapatta_58" class="code"><span id="wallapatta_59" class="text">_</span></code><span id="wallapatta_60" class="text"> for fp.js will give a similar code - </span><code id="wallapatta_61" class="code"><span id="wallapatta_62" class="text">$.rect</span></code><span id="wallapatta_63" class="text">, </span><code id="wallapatta_64" class="code"><span id="wallapatta_65" class="text">$.line</span></code><span id="wallapatta_66" class="text">, etc.</span></p></div></div><pre id="wallapatta_19" class="codeBlock"><code class="coffeescript">FP d3, <span class="hljs-function">-&gt;</span>
 <span class="hljs-property">@select</span> <span class="hljs-string">'body'</span>, <span class="hljs-function">-&gt;</span>
  <span class="hljs-property">@svg</span> <span class="hljs-attribute">width</span>: <span class="hljs-string">"100%"</span>, <span class="hljs-attribute">height</span>: <span class="hljs-string">"100%"</span>, <span class="hljs-function">-&gt;</span>
    <span class="hljs-property">@selectAll</span> <span class="hljs-string">'g.bar'</span>, <span class="hljs-function">-&gt;</span>
     <span class="hljs-property">@data</span> numbers, <span class="hljs-function">-&gt;</span>
      <span class="hljs-property">@enter</span> -&gt;
       <span class="hljs-property">@g</span> <span class="hljs-string">'.bar'</span>, <span class="hljs-function">-&gt;</span>
        <span class="hljs-property">@rect</span>
         <span class="hljs-attribute">y</span>: <span class="hljs-function">(<span class="hljs-params">(d)</span> -&gt;</span> chartHeight - d * <span class="hljs-number">10</span>)
         <span class="hljs-attribute">x</span>: <span class="hljs-function">(<span class="hljs-params">(d, i)</span> -&gt;</span> i * <span class="hljs-number">20</span>)
         <span class="hljs-attribute">width</span>: <span class="hljs-number">20</span>, <span class="hljs-attribute">height</span>: <span class="hljs-function">(<span class="hljs-params">(d)</span> -&gt;</span> d * <span class="hljs-number">10</span>)
        <span class="hljs-property">@line</span> <span class="hljs-string">'.budget'</span>,
         <span class="hljs-attribute">y1</span>: <span class="hljs-function">(<span class="hljs-params">(d)</span> -&gt;</span> chartHeight - d * <span class="hljs-number">9</span>)
         <span class="hljs-attribute">y2</span>: <span class="hljs-function">(<span class="hljs-params">(d)</span> -&gt;</span> chartHeight - d * <span class="hljs-number">9</span>)
         <span class="hljs-attribute">x1</span>: <span class="hljs-function">(<span class="hljs-params">(d, i)</span> -&gt;</span> i * <span class="hljs-number">20</span>)
         <span class="hljs-attribute">x2</span>: <span class="hljs-function">(<span class="hljs-params">(d, i)</span> -&gt;</span> i * <span class="hljs-number">20</span> + <span class="hljs-number">20</span>)
         <span class="hljs-attribute">stroke</span>: <span class="hljs-function">(<span class="hljs-params">(d)</span> -&gt;</span> <span class="hljs-keyword">if</span> d &lt; <span class="hljs-number">20</span> <span class="hljs-keyword">then</span> <span class="hljs-string">"white"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"#aaa"</span>)</code></pre></div>
     </div>
     <div class="wallapatta-sidebar three columns ">
      <div id="wallapatta_3" class="sidenote"><div id="wallapatta_4" class="section"><div class="content"><p id="wallapatta_5" class="paragraph"><strong id="wallapatta_24" class="bold"><span id="wallapatta_25" class="text">Update (December 29, 2013)</span></strong></p></div></div><div id="wallapatta_6" class="section"><div class="content"><p id="wallapatta_7" class="paragraph"><span id="wallapatta_26" class="text">Upgraded to support the format at the bottom. Check out </span><a id="wallapatta_27" class="link" href="http://bl.ocks.org/vpj/8168794">this</a><span id="wallapatta_28" class="text"> rewrite of the d3.js </span><a id="wallapatta_29" class="link" href="http://bl.ocks.org/mbostock/3887051">Grouped Bar Chart Example</a><span id="wallapatta_30" class="text"> using fp.js.</span></p></div></div></div>
     </div>
     <div style="display:none;">
      <div class='wallapatta-code'>///Coffeescript helpers for d3.js

&lt;&lt;https://github.com/vpj/FP(fp.js)&gt;&gt; is a tiny library to help keep &lt;&lt;http://d3js.org/(d3.js)&gt;&gt; dom manipulation code clean.

&gt;&gt;&gt;
 **Update (December 29, 2013)

 Upgraded to support the format at the bottom. Check out &lt;&lt;http://bl.ocks.org/vpj/8168794(this)&gt;&gt; rewrite of the d3.js &lt;&lt;http://bl.ocks.org/mbostock/3887051(Grouped Bar Chart Example)&gt;&gt; using fp.js.

I write a lot of d3.js code and most dom manipulation code got complicated and hard to maintain. With fp.js attributes, styles and events can be set easily. But the most important fact is that FP.js lets you maintain indentation in coffescript code that matches the dom structure.

```coffeescript
 numbers = [5, 3, 23, 6, 7, 0, 1, 25, 11, 19, 20]
 chartHeight = 300

 chart = d3.select("body")
  .append("svg")
  .attr("width", "100%")
  .attr("height", "100%")

 bars = chart.selectAll("g.bar").data(numbers).enter()
  .append("g")
  .attr("class", "bar")

 bars.append("rect")
  .attr("y", (d) -&gt; chartHeight - d * 10)
  .attr("x", (d, i) -&gt; i * 20)
  .attr("width", 20)
  .attr("height", (d) -&gt; d * 10)

 bars.append("line")
  .attr("class", "budget")
  .attr("y1", (d) -&gt; chartHeight - d * 9)
  .attr("y2", (d) -&gt; chartHeight - d * 9)
  .attr("x1", (d, i) -&gt; i * 20)
  .attr("x2", (d, i) -&gt; i * 20 + 20)
  .attr("stroke", (d) -&gt; if d &lt; 20 then "white" else "#aaa")

Above is plain code to draw a simple bar chart with d3.js, and below is the code with FP.js.

```coffeescript
 numbers = [5, 3, 23, 6, 7, 0, 1, 25, 11, 19, 20]
 chartHeight = 300

 FP d3, 'select', 'body', -&gt;
  FP @, 'svg', width: "100%", height: "100%", -&gt;
    FP @, 'selectAll', 'g.bar', -&gt;
     FP @, 'data', numbers, -&gt;
      FP @, 'enter', -&gt;
       FP @, 'g.bar', -&gt;
        FP @, 'rect',
         y: ((d) -&gt; chartHeight - d * 10)
         x: ((d, i) -&gt; i * 20)
         width: 20, height: ((d) -&gt; d * 10)
        FP @, 'line.budget',
         y1: ((d) -&gt; chartHeight - d * 9)
         y2: ((d) -&gt; chartHeight - d * 9)
         x1: ((d, i) -&gt; i * 20)
         x2: ((d, i) -&gt; i * 20 + 20)
         stroke: ((d) -&gt; if d &lt; 20 then "white" else "#aaa")

I am planning to remove the clutter of ``FP @``, so that it'll look like the following; but for that I will have to either use `with` keyword or create functions for ``select``, ``rect``, ``line``, etc, in a local context similar to &lt;&lt;https://github.com/mauricemach/coffeekup/blob/master/src/coffeekup.coffee(coffeekup)&gt;&gt;.

```coffeescript
 FP d3, -&gt;
  select 'body', -&gt;
   svg width: "100%", height: "100%", -&gt;
     selectAll 'g.bar', -&gt;
      data numbers, -&gt;
       enter -&gt;
        g '.bar', -&gt;
         rect
          y: ((d) -&gt; chartHeight - d * 10)
          x: ((d, i) -&gt; i * 20)
          width: 20, height: ((d) -&gt; d * 10)
         line '.budget',
          y1: ((d) -&gt; chartHeight - d * 9)
          y2: ((d) -&gt; chartHeight - d * 9)
          x1: ((d, i) -&gt; i * 20)
          x2: ((d, i) -&gt; i * 20 + 20)
          stroke: ((d) -&gt; if d &lt; 20 then "white" else "#aaa")

Another option is to use ``@``, which cleaner and not that messy, but code readers might get confused whether ``@`` is referring to the object you are making the call from. Also, using a one letter name such as **$** or ``_`` for fp.js will give a similar code - ``$.rect``, ``$.line``, etc.

```coffeescript
 FP d3, -&gt;
  @select 'body', -&gt;
   @svg width: "100%", height: "100%", -&gt;
     @selectAll 'g.bar', -&gt;
      @data numbers, -&gt;
       @enter -&gt;
        @g '.bar', -&gt;
         @rect
          y: ((d) -&gt; chartHeight - d * 10)
          x: ((d, i) -&gt; i * 20)
          width: 20, height: ((d) -&gt; d * 10)
         @line '.budget',
          y1: ((d) -&gt; chartHeight - d * 9)
          y2: ((d) -&gt; chartHeight - d * 9)
          x1: ((d, i) -&gt; i * 20)
          x2: ((d, i) -&gt; i * 20 + 20)
          stroke: ((d) -&gt; if d &lt; 20 then "white" else "#aaa")
</div>
     </div>
    </div>
   </div>
  </div>
  <script src="lib/highlightjs/highlight.pack.js">
  </script>
  <script src="lib/weya/weya.js">
  </script>
  <script src="lib/weya/base.js">
  </script>
  <script src="lib/mod/mod.js">
  </script>
  <script src="js/static.js?v=9">
  </script>
  <script src="js/parser.js?v=9">
  </script>
  <script src="js/reader.js?v=9">
  </script>
  <script src="js/nodes.js?v=9">
  </script>
  <script src="js/render.js?v=9">
  </script>
 </body>
</html>
