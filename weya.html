<!DOCTYPE html><html>
 <head>
  <meta charset="utf-8">
  </meta>
  <title>
   Weya.coffee
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </meta>
  <meta name="apple-mobile-web-app-capable" content="yes">
  </meta>
  <link href="http://fonts.googleapis.com/css?family=Raleway:400,100,200,300,500,600,700,800,900" rel="stylesheet" type="text/css">
  </link>
  <link href="lib/skeleton/css/skeleton.css" rel="stylesheet">
  </link>
  <link href="lib/highlightjs/styles/default.css" rel="stylesheet">
  </link>
  <link href="css/style.css" rel="stylesheet">
  </link>
  <link href="blog.css" rel="stylesheet">
  </link>
  <script>
   (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-37809145-1', 'auto');
ga('send', 'pageview');
  </script>
 </head>
 <body>
  <div class="container wallapatta-container">
   <div class="header">
    <h1>
     <a href="index.html">
      VARUNA JAYASIRI
     </a>
    </h1>
    <a class="button" href="https://www.twitter.com/vpj">
     @vpj
    </a>
   </div>
   <div class="wallapatta">
    <h1 class="title">
     Weya.coffee
    </h1>
    <h3 class="date">
     March 19, 2014
    </h3>
    <div class="row">
     <div class="wallapatta-main nine columns">
      <div id="wallapatta_0" class="article"><div id="wallapatta_1" class="section"><div class="content"><p id="wallapatta_2" class="paragraph"><span id="wallapatta_38" class="text">Weya.coffee is a lightweight library with no dependencies to generate DOM elements. We developed it to replace </span><a id="wallapatta_39" class="link" href="https://github.com/gradus/coffeecup">Coffeecup</a><span id="wallapatta_40" class="text"> as a client side template engine. Because of its simplicity and performance, we are also using Weya to replace DOM manipulation of </span><a id="wallapatta_41" class="link" href="http://d3js.org/">d3.js</a><span id="wallapatta_42" class="text"> in data visualizations.</span></p></div></div><div id="wallapatta_9" class="section"><div class="content"><p id="wallapatta_10" class="paragraph"><span id="wallapatta_45" class="text">Here's a small example to show the usage.</span></p></div></div><pre id="wallapatta_11" class="codeBlock"><code class="coffee">userElems = []
Weya container, <span class="hljs-function">-&gt;</span>
 <span class="hljs-property">@div</span> <span class="hljs-string">".users"</span>, <span class="hljs-function">-&gt;</span>
  <span class="hljs-keyword">for</span> user, i <span class="hljs-keyword">in</span> users
   userDiv = <span class="hljs-property">@div</span> <span class="hljs-string">'.user'</span>, <span class="hljs-attribute">on</span>: {<span class="hljs-attribute">click</span>: editUser}, <span class="hljs-function">-&gt;</span>
    name = <span class="hljs-property">@span</span> <span class="hljs-string">".name"</span>, user.name
    <span class="hljs-property">@span</span> <span class="hljs-string">".phone"</span>, user.phone
    <span class="hljs-keyword">if</span> v.image?
     <span class="hljs-property">@img</span> <span class="hljs-attribute">src</span>: user.image

   userDiv.userId = i
   userElems.push <span class="hljs-attribute">user</span>: user, <span class="hljs-attribute">name</span>: name</code></pre><div id="wallapatta_12" class="section"><div class="content"><p id="wallapatta_13" class="paragraph"><span id="wallapatta_46" class="text">The above code creates a list of users. It binds the data to the dom element </span><code id="wallapatta_47" class="code"><span id="wallapatta_48" class="text">userDiv.userId = i</span></code><span id="wallapatta_49" class="text"> and also keeps track of all the DOM elements in </span><code id="wallapatta_50" class="code"><span id="wallapatta_51" class="text">userElems</span></code><span id="wallapatta_52" class="text">. This is important if you want to manipulate the DOM without reloading the entire user list, for example if a name of a user changes you could change it with </span><code id="wallapatta_53" class="code"><span id="wallapatta_54" class="text">userElems[changedUserId].name.textContent = changedUserName</span></code><span id="wallapatta_55" class="text">.</span></p></div></div><div id="wallapatta_14" class="section"><h1 class="heading"><span id="wallapatta_15" class="block"><span id="wallapatta_56" class="text">Is it a template engine?</span></span></h1><div class="content"><div id="wallapatta_16" class="section"><div class="content"><p id="wallapatta_17" class="paragraph"><span id="wallapatta_57" class="text">Weya is quite similar to Coffeecup in terms of the syntax. But it's much faster, so it won't fail if you have lots of elements.</span></p></div></div><div id="wallapatta_21" class="section"><div class="content"><p id="wallapatta_22" class="paragraph"><span id="wallapatta_59" class="text">Also, Weya lets you register event handlers. I feel this is much cleaner than registering events later with CSS selectors, and it's easier to maintain the code since events are register within the DOM creation code.</span></p></div></div></div></div><div id="wallapatta_23" class="section"><h1 class="heading"><span id="wallapatta_24" class="block"><span id="wallapatta_60" class="text">Can it replace d3.js?</span></span></h1><div class="content"><div id="wallapatta_25" class="section"><div class="content"><p id="wallapatta_26" class="paragraph"><span id="wallapatta_61" class="text">We use weya to replace most all the d3.js DOM manipulation.</span></p></div></div><div id="wallapatta_27" class="section"><div class="content"><p id="wallapatta_28" class="paragraph"><span id="wallapatta_62" class="text">Code with Weya is simpler, shorter and nicely intended. Here's the code that draws bar chart in	</span><a id="wallapatta_63" class="link" href="http://bl.ocks.org/vpj/9636655">this example</a><span id="wallapatta_64" class="text">.</span></p></div></div><pre id="wallapatta_29" class="codeBlock"><code class="coffee">Weya svg, <span class="hljs-function">-&gt;</span>
 <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> data
  <span class="hljs-property">@g</span> <span class="hljs-string">".g"</span>, <span class="hljs-attribute">transform</span>: <span class="hljs-string">"translate(<span class="hljs-subst">#{x0 d.State}</span>,0)"</span>, <span class="hljs-function">-&gt;</span>
   <span class="hljs-keyword">for</span> age <span class="hljs-keyword">in</span> d.ages
    <span class="hljs-property">@rect</span>
     <span class="hljs-attribute">width</span>: x1.rangeBand()
     <span class="hljs-attribute">x</span>: x1 age.name
     <span class="hljs-attribute">y</span>: y age.value
     <span class="hljs-attribute">height</span>: height - y age.value
     <span class="hljs-attribute">fill</span>: color age.name

 <span class="hljs-keyword">for</span> d, i <span class="hljs-keyword">in</span> ageNames.slice().reverse()
  <span class="hljs-property">@g</span> <span class="hljs-string">".legend"</span>, <span class="hljs-attribute">transform</span>: <span class="hljs-string">"translate(0,<span class="hljs-subst">#{i * <span class="hljs-number">20</span>}</span>)"</span>, <span class="hljs-function">-&gt;</span>
   <span class="hljs-property">@rect</span> <span class="hljs-attribute">x</span>: width - <span class="hljs-number">18</span>, <span class="hljs-attribute">width</span>: <span class="hljs-number">18</span>, <span class="hljs-attribute">height</span>: <span class="hljs-number">18</span>, <span class="hljs-attribute">fill</span>: color d
   <span class="hljs-property">@text</span>
    <span class="hljs-attribute">x</span>: width - <span class="hljs-number">24</span>, <span class="hljs-attribute">y</span>: <span class="hljs-number">9</span>, <span class="hljs-attribute">dy</span>: <span class="hljs-string">".35em"</span>
    <span class="hljs-attribute">style</span>: {<span class="hljs-string">'text-anchor'</span>: <span class="hljs-string">"end"</span>}, <span class="hljs-attribute">text</span>: d</code></pre><div id="wallapatta_30" class="section"><div class="content"><p id="wallapatta_31" class="paragraph"><span id="wallapatta_65" class="text">Here's the code that does the </span><a id="wallapatta_66" class="link" href="http://bl.ocks.org/mbostock/388705">same with d3.js</a><span id="wallapatta_67" class="text">.</span></p></div></div><pre id="wallapatta_32" class="codeBlock"><code class="javascript"><span class="hljs-keyword">var</span> state = svg.selectAll(<span class="hljs-string">".state"</span>)
    .data(data)
  .enter().append(<span class="hljs-string">"g"</span>)
    .attr(<span class="hljs-string">"class"</span>, <span class="hljs-string">"g"</span>)
    .attr(<span class="hljs-string">"transform"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> </span>{ <span class="hljs-keyword">return</span> <span class="hljs-string">"translate("</span> + x0(d.State) + <span class="hljs-string">",0)"</span>; });

state.selectAll(<span class="hljs-string">"rect"</span>)
    .data(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> </span>{ <span class="hljs-keyword">return</span> d.ages; })
  .enter().append(<span class="hljs-string">"rect"</span>)
    .attr(<span class="hljs-string">"width"</span>, x1.rangeBand())
    .attr(<span class="hljs-string">"x"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> </span>{ <span class="hljs-keyword">return</span> x1(d.name); })
    .attr(<span class="hljs-string">"y"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> </span>{ <span class="hljs-keyword">return</span> y(d.value); })
    .attr(<span class="hljs-string">"height"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> </span>{ <span class="hljs-keyword">return</span> height - y(d.value); })
    .style(<span class="hljs-string">"fill"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> </span>{ <span class="hljs-keyword">return</span> color(d.name); });

<span class="hljs-keyword">var</span> legend = svg.selectAll(<span class="hljs-string">".legend"</span>)
    .data(ageNames.slice().reverse())
  .enter().append(<span class="hljs-string">"g"</span>)
    .attr(<span class="hljs-string">"class"</span>, <span class="hljs-string">"legend"</span>)
    .attr(<span class="hljs-string">"transform"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d, i)</span> </span>{ <span class="hljs-keyword">return</span> <span class="hljs-string">"translate(0,"</span> + i * <span class="hljs-number">20</span> + <span class="hljs-string">")"</span>; });

legend.append(<span class="hljs-string">"rect"</span>)
    .attr(<span class="hljs-string">"x"</span>, width - <span class="hljs-number">18</span>)
    .attr(<span class="hljs-string">"width"</span>, <span class="hljs-number">18</span>)
    .attr(<span class="hljs-string">"height"</span>, <span class="hljs-number">18</span>)
    .style(<span class="hljs-string">"fill"</span>, color);

legend.append(<span class="hljs-string">"text"</span>)
    .attr(<span class="hljs-string">"x"</span>, width - <span class="hljs-number">24</span>)
    .attr(<span class="hljs-string">"y"</span>, <span class="hljs-number">9</span>)
    .attr(<span class="hljs-string">"dy"</span>, <span class="hljs-string">".35em"</span>)
    .style(<span class="hljs-string">"text-anchor"</span>, <span class="hljs-string">"end"</span>)
    .text(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> </span>{ <span class="hljs-keyword">return</span> d; });</code></pre><div id="wallapatta_33" class="section"><div class="content"><p id="wallapatta_34" class="paragraph"><span id="wallapatta_68" class="text">Another problem we solved with Weya is that d3.js draws all the elements that are represented by the data at once. And with Weya we can draw progressively - this is quite useful when you have a lot of data and you don't won't the interface to go unresponsive until everything is drawn. Here's a small example to show the point.</span></p></div></div><pre id="wallapatta_35" class="codeBlock"><code class="coffee">i = <span class="hljs-number">0</span>
data = ...
<span class="hljs-function">
<span class="hljs-title">draw</span> = -&gt;</span>
 <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> i <span class="hljs-keyword">is</span> data.length

 d = data[i]
 Weya container, <span class="hljs-function">-&gt;</span>
  <span class="hljs-property">@div</span> <span class="hljs-string">'.user'</span>, <span class="hljs-function">-&gt;</span>
   ...

 i++
 requestAnimationFrame draw

draw()</code></pre><div id="wallapatta_36" class="section"><div class="content"><p id="wallapatta_37" class="paragraph"><span id="wallapatta_69" class="text">The disadvantage of Weya over d3.js is that it doesn't bind data to DOM elements like d3.js does. So you can't use </span><code id="wallapatta_70" class="code"><span id="wallapatta_71" class="text">enter()</span></code><span id="wallapatta_72" class="text">, </span><code id="wallapatta_73" class="code"><span id="wallapatta_74" class="text">exit()</span></code><span id="wallapatta_75" class="text"> and updates when data changes. But most users rarely need these features. We use Weya with our own data bindings with DOM elements (as in the first example with </span><code id="wallapatta_76" class="code"><span id="wallapatta_77" class="text">userElems</span></code><span id="wallapatta_78" class="text">), and we find it simpler than </span><code id="wallapatta_79" class="code"><span id="wallapatta_80" class="text">enter()</span></code><span id="wallapatta_81" class="text"> and </span><code id="wallapatta_82" class="code"><span id="wallapatta_83" class="text">exit()</span></code><span id="wallapatta_84" class="text">.</span></p></div></div></div></div></div>
     </div>
     <div class="wallapatta-sidebar three columns">
      <div id="wallapatta_3" class="sidenote"><div id="wallapatta_4" class="html"><iframe src="https://ghbtns.com/github-btn.html?user=vpj&amp;repo=weya&amp;type=star&amp;count=true&amp;size=large" frameborder="0" scrolling="0" width="160px" height="30px"></iframe>
</div><div id="wallapatta_5" class="section"><div class="content"><p id="wallapatta_6" class="paragraph"><a id="wallapatta_43" class="link" href="http://jsperf.com/weya-jquery-d3-coffeecup">Performance comparison among d3, coffeecup and weya</a></p></div></div><div id="wallapatta_7" class="section"><div class="content"><p id="wallapatta_8" class="paragraph"><a id="wallapatta_44" class="link" href="http://bl.ocks.org/vpj/9636655">Bar chart example</a></p></div></div></div><div id="wallapatta_18" class="sidenote"><div id="wallapatta_19" class="section"><div class="content"><p id="wallapatta_20" class="paragraph"><a id="wallapatta_58" class="link" href="http://jsperf.com/weya-jquery-d3-coffeecup">Performance comparison among d3, coffeecup and weya</a></p></div></div></div>
     </div>
     <div style="display:none;">
      <div class='wallapatta-code'>Weya.coffee is a lightweight library with no dependencies to generate DOM elements. We developed it to replace <<https://github.com/gradus/coffeecup(Coffeecup)>> as a client side template engine. Because of its simplicity and performance, we are also using Weya to replace DOM manipulation of <<http://d3js.org/(d3.js)>> in data visualizations.

>>>
 <<<
  <iframe src="https://ghbtns.com/github-btn.html?user=vpj&repo=weya&type=star&count=true&size=large" frameborder="0" scrolling="0" width="160px" height="30px"></iframe>

 <<http://jsperf.com/weya-jquery-d3-coffeecup(Performance comparison among d3, coffeecup and weya)>>

 <<http://bl.ocks.org/vpj/9636655(Bar chart example)>>

Here's a small example to show the usage.

```coffee
 userElems = []
 Weya container, ->
  @div ".users", ->
   for user, i in users
    userDiv = @div '.user', on: {click: editUser}, ->
     name = @span ".name", user.name
     @span ".phone", user.phone
     if v.image?
      @img src: user.image

    userDiv.userId = i
    userElems.push user: user, name: name

The above code creates a list of users. It binds the data to the dom element ``userDiv.userId = i`` and also keeps track of all the DOM elements in ``userElems``. This is important if you want to manipulate the DOM without reloading the entire user list, for example if a name of a user changes you could change it with ``userElems[changedUserId].name.textContent = changedUserName``.

#Is it a template engine?

 Weya is quite similar to Coffeecup in terms of the syntax. But it's much faster, so it won't fail if you have lots of elements.

 >>>
  <<http://jsperf.com/weya-jquery-d3-coffeecup(Performance comparison among d3, coffeecup and weya)>>


 Also, Weya lets you register event handlers. I feel this is much cleaner than registering events later with CSS selectors, and it's easier to maintain the code since events are register within the DOM creation code.

#Can it replace d3.js?

 We use weya to replace most all the d3.js DOM manipulation.

 Code with Weya is simpler, shorter and nicely intended. Here's the code that draws bar chart in	<<http://bl.ocks.org/vpj/9636655(this example)>>.

 ```coffee
  Weya svg, ->
   for d in data
    @g ".g", transform: "translate(#{x0 d.State},0)", ->
     for age in d.ages
      @rect
       width: x1.rangeBand()
       x: x1 age.name
       y: y age.value
       height: height - y age.value
       fill: color age.name

   for d, i in ageNames.slice().reverse()
    @g ".legend", transform: "translate(0,#{i * 20})", ->
     @rect x: width - 18, width: 18, height: 18, fill: color d
     @text
      x: width - 24, y: 9, dy: ".35em"
      style: {'text-anchor': "end"}, text: d

 Here's the code that does the <<http://bl.ocks.org/mbostock/388705(same with d3.js)>>.

 ```javascript
  var state = svg.selectAll(".state")
      .data(data)
    .enter().append("g")
      .attr("class", "g")
      .attr("transform", function(d) { return "translate(" + x0(d.State) + ",0)"; });

  state.selectAll("rect")
      .data(function(d) { return d.ages; })
    .enter().append("rect")
      .attr("width", x1.rangeBand())
      .attr("x", function(d) { return x1(d.name); })
      .attr("y", function(d) { return y(d.value); })
      .attr("height", function(d) { return height - y(d.value); })
      .style("fill", function(d) { return color(d.name); });

  var legend = svg.selectAll(".legend")
      .data(ageNames.slice().reverse())
    .enter().append("g")
      .attr("class", "legend")
      .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

  legend.append("rect")
      .attr("x", width - 18)
      .attr("width", 18)
      .attr("height", 18)
      .style("fill", color);

  legend.append("text")
      .attr("x", width - 24)
      .attr("y", 9)
      .attr("dy", ".35em")
      .style("text-anchor", "end")
      .text(function(d) { return d; });


 Another problem we solved with Weya is that d3.js draws all the elements that are represented by the data at once. And with Weya we can draw progressively - this is quite useful when you have a lot of data and you don't won't the interface to go unresponsive until everything is drawn. Here's a small example to show the point.

 ```coffee
  i = 0
  data = ...

  draw = ->
   return if i is data.length

   d = data[i]
   Weya container, ->
    @div '.user', ->
     ...

   i++
   requestAnimationFrame draw

  draw()

 The disadvantage of Weya over d3.js is that it doesn't bind data to DOM elements like d3.js does. So you can't use ``enter()``, ``exit()`` and updates when data changes. But most users rarely need these features. We use Weya with our own data bindings with DOM elements (as in the first example with ``userElems``), and we find it simpler than ``enter()`` and ``exit()``.
</div>
     </div>
    </div>
   </div>
  </div>
  <script src="lib/highlightjs/highlight.pack.js">
  </script>
  <script src="lib/weya/weya.js">
  </script>
  <script src="lib/weya/base.js">
  </script>
  <script src="lib/mod/mod.js">
  </script>
  <script src="js/static.js?v=9">
  </script>
  <script src="js/parser.js?v=9">
  </script>
  <script src="js/reader.js?v=9">
  </script>
  <script src="js/nodes.js?v=9">
  </script>
  <script src="js/render.js?v=9">
  </script>
 </body>
</html>
